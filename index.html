<!DOCTYPE html>
<html lang="en">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <meta charset="UTF-8">
        <title>gallery</title>
        <link rel="stylesheet" href="main.css">
    </head>
    <body>

        <div class="container" ></div>
        <div class="inputs">
            <form id="add-contact">
                <fieldset>
                    <div class="form-group">
                        <label class="control-label">Name</label>
                        <input class="form-control" type="text" placeholder="Name">
                    </div>
                    <div class="form-group">
                        <label class="control-label" >Age</label>
                        <input class="form-control" type="text" placeholder="Age">
                    </div>
                    <div class="form-group">
                        <label class="control-label">Image Url</label>
                        <input class="form-control" type="text" placeholder="Image Url"/>
                    </div>
                    <div class="form-group">
                        <button class="form-control" type="submit" >Add</button>
                    </div>

                </fieldset>
            </form>
        </div>
        <script src="jquery-1.11.0.min.js"></script>
        <script type="application/javascript">
            var parse_url = function (url) {
                return /^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/.test(url);
            }
            /*var IsValidImageUrl = function (url) {
                var img = img || new Image();
                img.src = url;
                console.dir(img.width);
                //alert(img.height != 0);
            }*/





            function insertContacts(contact) {
                var img = $('<img>', {
                                src: contact.img,
                                class: 'pic',
                                draggable: 'false',
                                alt: contact.name
                            }),
                    name = $('<div>').text(contact.name).addClass('center'),
                    age = $('<div>').text(contact.age).addClass('center'),
                    close = $('<img>').attr('src', 'close.png').addClass('close-img').click(function () {
                        this.parentNode.remove();
                    }),
                    content = $('<div>').addClass('content').append(close, img, name, age);
                /*$(content + ":after").addRule({
                    content: " alsdmksaldasdkasdlsad klasd sa",
                    color: "red"
                });*/
                $('.container').append(content);
            }

            $("#add-contact").submit(function(e){
                var info = {};
                e.preventDefault();
                info['name'] = e.target[1].value;
                info['age'] = e.target[2].value;
                info['img'] = e.target[3].value;
                if(info.img === '' || info.name === '' || !parse_url(info.img) || !typeof info.name === 'string' || isNaN(parseInt(info.age))) {
                    alert('incorrect');
                    return false;
                }
                $('input').val('');
                insertContacts(info);
            });
            $.ajax({
                url: "local.json",
                success: function (data) {
                    var contacts = data.contacts;
                    for (var contact in contacts){
                        if(contacts.hasOwnProperty(contact)){
                            contacts[contact].img = 'img/' + contacts[contact].img;
                            console.log(contact);
                            insertContacts(contacts[contact]);
                        }
                    }
                }
            });


            (function($) {
                $.fn.drags = function(opt) {

                    opt = $.extend({
                        handle: ".conent",
                        cursor: "move",
                        draggableClass: "draggable",
                        activeHandleClass: "active-handle"
                    }, opt);

                    var $selected = null;
                    var $elements = (opt.handle === "") ? this : this.find(opt.handle);

                    $elements.css('cursor', opt.cursor).on("mousedown", function(e) {
                        if(opt.handle === "") {
                            $selected = $(this);
                            $selected.addClass(opt.draggableClass);
                        } else {
                            $selected = $(this).parent();
                            $selected.addClass(opt.draggableClass).find(opt.handle).addClass(opt.activeHandleClass);
                        }
                        var drg_h = $selected.outerHeight(),
                                drg_w = $selected.outerWidth(),
                                pos_y = $selected.offset().top + drg_h - e.pageY,
                                pos_x = $selected.offset().left + drg_w - e.pageX;
                        $(document).on("mousemove", function(e) {
                            $selected.offset({
                                top: e.pageY + pos_y - drg_h,
                                left: e.pageX + pos_x - drg_w
                            });
                        }).on("mouseup", function() {
                            $(this).off("mousemove"); // Unbind events from document
                            if ($selected !== null) {
                                $selected.removeClass(opt.draggableClass);
                                $selected = null;
                            }
                        });
                        e.preventDefault(); // disable selection
                    }).on("mouseup", function() {
                        if(opt.handle === "") {
                            $selected.removeClass(opt.draggableClass);
                        } else {
                            $selected.removeClass(opt.draggableClass)
                                    .find(opt.handle).removeClass(opt.activeHandleClass);
                        }
                        $selected = null;
                    });
                    return this;
                };
            })(jQuery);

/*
            $(document).ready(function() {
                var $dragging = null;
                $(document.body).on("mousemove", function(e) {
                    if ($dragging) {
                        $dragging.offset({
                            top: e.pageY,
                            left: e.pageX
                        });
                    }
                });


                $(document.body).on("mousedown", ".content", function (e) {

                    $dragging = $(e.target);
                });

                $(document.body).on("mouseup", function (e) {
                    $dragging = null;
                });
            });
*/
        </script>
    </body>
</html>
